<div nz-row class="content">

  <div nz-col nzSpan="10" class="sideInfo">
    <h1 nz-typography>{{sideInfo.title}}</h1>
    <h2 nz-typography> {{sideInfo.subTitle}}</h2>
    <p> {{sideInfo.content }}</p>
    <a>Know More</a>
    <button nz-button routerLink="/login">Sign In</button>
  </div>

  <div nz-col nzSpan="14">
    <nz-page-header nzTitle="Create Account">
      <!-- <nz-page-header-extra>
        <button nz-button (click)="onVerify()" nzType="primary">Go Check Email</button>
      </nz-page-header-extra> -->
      <nz-page-header-content>
        <nz-steps [nzCurrent]="current">
          <nz-step nzTitle="Information" nzIcon="form"></nz-step>
          <nz-step nzTitle="Email Verification" [nzIcon]="iconTemplate"></nz-step>
          <ng-template #iconTemplate>
            <i *ngIf="!verfication" nz-icon nzType="mail"></i>
            <i *ngIf="verfication == 'sent'" nz-icon nzType="check"></i>
            <i *ngIf="verfication == 'waiting'" nz-icon nzType="loading"></i>
            <i *ngIf="verfication == 'failed'" nz-icon nzType="close-circle" nzTheme="fill"></i>
          </ng-template>
          <nz-step nzTitle="complete" nzIcon="smile"></nz-step>
        </nz-steps>
      </nz-page-header-content>
    </nz-page-header>

    <form nz-form [formGroup]="signupForm" (ngSubmit)="onSubmit()" *ngIf="current==0">
      <nz-alert nzType="error" *ngIf="error == true" [nzMessage]="errorMsg" nzShowIcon> </nz-alert>

      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>Email</nz-form-label>
        <nz-form-control nzHasFeedback [nzErrorTip]="emailErrorTips" [nzSpan]="14">
          <nz-input-group nzPrefixIcon="mail">
            <input nz-input placeholder="E-mail" type="email" formControlName="email" />
            <ng-template #emailErrorTips let-control>
              <ng-container *ngIf="control.hasError('email')">Please input a valid email address!</ng-container>
              <ng-container *ngIf="control.hasError('required')">Email is required!</ng-container>
            </ng-template>
          </nz-input-group>
        </nz-form-control>
      </nz-form-item>

      <div formGroupName="password">
        <nz-form-item>
          <nz-form-label [nzSpan]="6" nzRequired>Password</nz-form-label>
          <nz-form-control nzHasFeedback [nzErrorTip]="passwordErrorTips" [nzSpan]="14">
            <nz-input-group nzPrefixIcon="lock" [nzSuffix]="suffixTemplate">
              <input nz-input placeholder="Password" [type]="passwordVisible ? 'text' : 'password'"
                formControlName="password" />
              <ng-template #passwordErrorTips let-control>
                <ng-container *ngIf="control.hasError('pattern')">
                  Must contain at least one number and one uppercase and
                  lowercase letter, and at least 8 or more characters!
                </ng-container>
                <ng-container *ngIf="control.hasError('required')">Password is required</ng-container>
              </ng-template>
            </nz-input-group>
            <ng-template #suffixTemplate>
              <i nz-icon [nzType]="passwordVisible ? 'eye' : 'eye-invisible'"
                (click)="passwordVisible = !passwordVisible"></i>
            </ng-template>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label [nzSpan]="6" nzRequired>Confirm Password</nz-form-label>
          <nz-form-control nzHasFeedback [nzErrorTip]="confirmPasswordErrorTips" [nzSpan]="14">
            <nz-input-group nzPrefixIcon="lock" [nzSuffix]="suffixTemplate">
              <input nz-input [type]="passwordVisible ? 'text' : 'password'" placeholder="Confirm Your Password"
                formControlName="confirmPassword" />
              <ng-template #confirmPasswordErrorTips let-control>
                <ng-container *ngIf="control.hasError('required')">This Feild is required!</ng-container>
                <ng-container *ngIf="control.hasError('noMatch')">Password doesn't match!</ng-container>
              </ng-template>
            </nz-input-group>
            <ng-template #suffixTemplate>
              <i nz-icon [nzType]="passwordVisible ? 'eye' : 'eye-invisible'"
                (click)="passwordVisible = !passwordVisible"></i>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </div>

      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>I am a</nz-form-label>
        <nz-form-control nzHasFeedback nzErrorTip="Please Choose one of the options available" [nzSpan]="14">
          <nz-radio-group formControlName="role">
            <label nz-radio nzValue="Buyer">Buyer</label>
            <label nz-radio nzValue="Seller">Supplier</label>
            <label nz-radio nzValue="Both">Both</label>
          </nz-radio-group>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>Mobile</nz-form-label>
        <nz-form-control nzHasFeedback [nzErrorTip]="ErrorTips" nzSpan="14">
          <input nz-input type="tel" formControlName="mobile" 
          ng2TelInput 
          [ng2TelInputOptions]="{initialCountry: initialCountry}"
          (ng2TelOutput)="getNumber($event)" 
          (hasError)="hasError($event)"
          (countryChange)="onCountryChange($event)"/> 
          <!-- style="width: 385px" -->
          <ng-template #ErrorTips let-control>
            <ng-container *ngIf="control.hasError('required')">Please enter your phone number!</ng-container>
            <!-- <ng-container *ngIf="control.hasError('pattern')">Please enter a valid phone number!</ng-container>  -->
            <ng-container *ngIf="control.hasError('invalidPhoneNumber')">Invalid Phone Number Please enter a valid phone number!</ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>Company Name</nz-form-label>
        <nz-form-control nzHasFeedback nzErrorTip="Please enter your Company Name!" [nzSpan]="14">
          <nz-input-group nzPrefixIcon="bank">
            <input nz-input placeholder="Company Name" type="text" formControlName="companyName" />
          </nz-input-group>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>Tin Number</nz-form-label>
        <nz-form-control nzHasFeedback [nzErrorTip]="tinNoErrorTips" [nzSpan]="14">
          <nz-input-group>
            <input nz-input placeholder="Your company Tin Number" formControlName="tinNumber" />
          </nz-input-group>
          <ng-template #tinNoErrorTips let-control>
            <ng-container *ngIf="control.hasError('required')">Please enter your Tin Number!</ng-container>
            <ng-container *ngIf="control.hasError('minlength') || control.hasError('maxlength')">Tin number should be a 10 digit number</ng-container> 
                    </ng-template>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>Full Name</nz-form-label>
        <nz-form-control nzHasFeedback nzErrorTip="Please enter both your first name and last name" [nzSpan]="14">
          <nz-input-group>
            <div nz-row [nzGutter]="4">
              <div nz-col nzSpan="12">
                <input type="text" nz-input placeholder="First Name" type="text" formControlName="firstName" />
              </div>
              <div nz-col nzSpan="12">
                <input type="text" nz-input placeholder="Last Name" type="text" formControlName="lastName"  />
              </div>
            </div>
          </nz-input-group>
          <!-- <ng-template #nameErrorTips let-control>
            <ng-container *ngIf="control.get('firstName').hasError('required')">First Name is required!</ng-container>
            <ng-container *ngIf="this.signUpForm.get('lastName').hasError('required')">Last Name is required!</ng-container>
          </ng-template> -->
       
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>Country</nz-form-label>
        <nz-form-control [nzSpan]="14" nzHasFeedback nzErrorTip="Please select your country!">
          <nz-select nzPrefixIcon="global" nzPlaceHolder="Select a country from the options availabl "
            formControlName="country" (ngModelChange)="onCountrySelected($event)">
            <nz-option nzCustomContent *ngFor="let country of countries; ;let i = index" [nzLabel]="country.name" [nzValue]="country.name"> <nz-avatar [nzShape]="'square'"  [nzSize]="20"  nzIcon="user" [nzSrc]="country.flag"></nz-avatar> {{countries[i].name}}</nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <!-- <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>Mobile</nz-form-label>
        <nz-form-control nzHasFeedback [nzErrorTip]="ErrorTips" [nzSpan]="14">
          <nz-input-group nzCompact [nzAddOnBefore]="addOnBeforeTemplate">
            <input type="email" nz-input placeholder="Mobile Number" />
            <ng-template #addOnBeforeTemplate>
              <nz-select nzBorderless nzPlaceHolder="dail code"  [(ngModel)]="selectedCountry" #areacode> 
                <nz-option *ngFor="let country of countries" [nzLabel]="country.callingCodes" [nzValue]="country.value"></nz-option>
              </nz-select>
            </ng-template>
          </nz-input-group>
         
        </nz-form-control>
      </nz-form-item> -->

      <!-- <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>Phone Number</nz-form-label>
        <nz-form-control nzHasFeedback nzErrorTip="Please input your phone number!" [nzSpan]="14"
          formArrayName="phoneNumbers">
          <nz-input-group nzPrefixIcon="phone" [nzAddOnAfter]="addOnAfterTemplate"
            *ngFor="let phoneNumber of phoneNumbers.controls; let id = index" style="margin-bottom: 10px;">
               <ng-template #addOnBeforeTemplate>
                [nzAddOnBefore]="addOnBeforeTemplate" 
                <nz-select> 
                  <nz-option *ngFor="let option of listOfOption" [nzLabel]="option" [nzValue]="option"></nz-option>
                  <nz-option nzLabel="+123" nzValue="+123"></nz-option>
                </nz-select>
              </ng-template> 
              <ng-template #addOnAfterTemplate>
                <i nz-icon nzType="plus" *ngIf="id==0" (click)="onAddPhoneNo()"></i>
                <i nz-icon nzType="close" *ngIf="id > 0" (click)="onRemovePhoneNo(id)"></i>
              </ng-template>
              <input nz-input type="text" placeholder="Telephone number" [formControlName]="id"/>
          </nz-input-group>
        </nz-form-control>
      </nz-form-item> -->

      <nz-form-item>
        <nz-form-control [nzOffset]="6" [nzSpan]="14">
          <label nz-checkbox formControlName="agree" nzTooltipTitle="agree to Terms & Conditions" nzTooltipPlacement="topLeft" nz-tooltip >{{agreement}}</label>
        </nz-form-control>
      </nz-form-item>

      <div nz-row>
        <div nz-col [nzOffset]="6" [nzSpan]="14" style="text-align: center;">
          <button nz-button nzBlock [nzType]="'primary'" type="submit" [disabled]='!signupForm.valid' >Agree and
            Register!</button>
          <p>Already Have an Account? <a routerLink="/login">Sign In! </a></p>
        </div>
      </div>
      
    </form>

    <nz-result *ngIf="current==1 && verfication == 'sent'" nzStatus="info"
      nzTitle="A confirmation Email has been sent to your mailbox {{userInfo.email}}"
      nzSubTitle="Please check your emial box and continue with your registration with in 24 hours">
      <div nz-result-extra>
        <button nz-button (click)="onVerify()" nzType="primary">Go Check Email</button>
        <button nz-button (click)="onResend()">Resend Verification code</button>
      </div>
    </nz-result>

    <nz-result *ngIf="current==1 && verfication == 'waiting'" nzStatus="info"
      nzTitle=" Waiting for your email confirmation"
      nzSubTitle="Please check your emial box and continue with your registration with in 24 hours">
    </nz-result>

    <nz-result *ngIf="current==1 && verfication == 'failed'" nzTitle="Confirmation Failed" nzStatus="error"
      nzSubTitle="This token has expired. Please click resend verfication code to get a new token.">
      <div nz-result-extra style="width: 80%; margin-left: 20%;">
        <form nz-form (ngSubmit)="onResend()" #resendForm="ngForm">
          <nz-alert *ngIf="error == true" nzType="error" [nzMessage]="errorMsg" nzCloseable nzShowIcon>
          </nz-alert>
          <nz-form-item>
            <nz-form-control nzErrorTip="Please Enter a Valid Email Address">
              <nz-input-group nzAddOnAfterIcon="mail">
                <input nz-input nzSize="large" type="email" [(ngModel)]='resendEmail' name="email"
                  placeholder="Your Email here" required email />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
          <button nz-button nzBlock type="submit" [nzType]="'primary'" [disabled]='!resendForm.valid'>Resend
            Verification code</button>
        </form>

      </div>
    </nz-result>

    <nz-result *ngIf="current==2" nzStatus="success"
      nzTitle='Congratulations, Your registration is Successfully completed!!'
      nzSubTitle="Please process to the login page to sign In and  complete and view your profile !">
      <div nz-result-extra>
        <button nz-button nzType="primary" routerLink="/login" routerLinkActive="active">Proceed to Login</button>
        <!-- <button nz-button routerLink='/my_account' routerLinkActive="active">Your Profile</button> -->
      </div>
    </nz-result>

  </div>
</div>